<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="persistence.modify.common.IModifyMapper">

    <sql id="selectModifyCadreAuthSearchSql">
      <where>
        <if test="userId!=null">
            and c.user_id=#{userId}
        </if>
          <if test="statusList!=null and statusList.length>0">
              and  c.status in
              <foreach collection="statusList" item="status"
                       index="index" open="(" close=")" separator=",">
                  #{status}
              </foreach>
          </if>
      </where>
    </sql>

    <select id="selectModifyCadreAuthList" resultMap="persistence.modify.ModifyCadreAuthMapper.BaseResultMap" parameterType="map">
        select mca.* from modify_cadre_auth mca
        left join cadre c on mca.cadre_id=c.id
        <include refid="selectModifyCadreAuthSearchSql" />
    </select>
    <select id="countModifyCadreAuthList" parameterType="map" resultType="java.lang.Integer">
        select count(mca.id) from modify_cadre_auth mca
        left join cadre c on mca.cadre_id=c.id
        <include refid="selectModifyCadreAuthSearchSql" />
    </select>

    <delete id="removeAllCadres" parameterType="map" >
        delete mca.* from modify_cadre_auth mca, cadre c where mca.cadre_id=c.id
        <if test="cadreStatusSet.size>0">
            and  c.status in
            <foreach collection="cadreStatusSet" item="status"
                     index="index" open="(" close=")" separator=",">
                #{status}
            </foreach>
        </if>
    </delete>

    <delete id="removeAllCadreParties" parameterType="map" >
        delete mca.* from modify_cadre_auth mca, cadre_party cp, cadre c where mca.cadre_id=c.id
        and cp.type=1 and cp.class_id != #{crowdId} and cp.user_id=c.user_id
    </delete>
</mapper>