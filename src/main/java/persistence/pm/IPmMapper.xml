<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="persistence.pm.IPmMapper">
    <sql id="member_selects_permits">
        <if test="addPermits">
            <if test="adminPartyIdList.size>0 and adminBranchIdList.size>0">
                and (
                party_id in
                <foreach collection="adminPartyIdList" item="partyId"
                         index="index" open="(" close=")" separator=",">
                    #{partyId}
                </foreach>
                or
                branch_id in
                <foreach collection="adminBranchIdList" item="branchId"
                         index="index" open="(" close=")" separator=",">
                    #{branchId}
                </foreach>
                )
            </if>
            <if test="adminPartyIdList.size>0 and adminBranchIdList.size==0">
                and party_id in
                <foreach collection="adminPartyIdList" item="partyId"
                         index="index" open="(" close=")" separator=",">
                    #{partyId}
                </foreach>
            </if>
            <if test="adminPartyIdList.size==0 and adminBranchIdList.size>0">
                and  branch_id in
                <foreach collection="adminBranchIdList" item="branchId"
                         index="index" open="(" close=")" separator=",">
                    #{branchId}
                </foreach>
            </if>
        </if>
    </sql>
    <select id="selectPmInitCount" parameterType="map" resultType="map">
        select sum(if(status=0 and is_back=0,1,0)) as pm_initCount,
        sum(if(is_back=1 and status=0,1,0)) as pm_backCount,
        sum(if(status=1,1,0)) as pm_passCount ,
        sum(if(status=2,1,0)) as pm_denyCount from pm_meeting m
        where m.type=#{type} and m.is_delete=0
        <include refid="member_selects_permits"/>
    </select>
</mapper>