<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="persistence.party.common.IPartyMapper">

    <sql id="organizerSearchSql">
        <where>
        <!--排除 历任 状态-->
        oo.status!=3
        <if test="type != null">
            and oo.type=#{type}
        </if>
        <if test="status != null">
            and oo.status=#{status}
        </if>
        <if test="query != null">
          and (uv.username like '${query}%'
              or uv.realname like '${query}%'
              or uv.code like '${query}%')
        </if>
        </where>
    </sql>
    <select id="selectOrganizerList" resultMap="persistence.party.OrganizerMapper.BaseResultMap" parameterType="map">
        select oo.* from ow_organizer oo left join sys_user_view uv on oo.user_id=uv.id
         <include refid="organizerSearchSql"/>
        order by oo.type asc, oo.status asc, oo.sort_order asc
    </select>
    <select id="countOrganizerList" parameterType="map" resultType="java.lang.Integer">
       select count(oo.id) from ow_organizer oo left join sys_user_view uv on oo.user_id=uv.id
         <include refid="organizerSearchSql"/>
    </select>

    <sql id="orgAdminSearchSql">
        <where>
        <if test="type != null">
            and oo.type=#{type}
        </if>
        <if test="query != null">
          and (uv.username like '${query}%'
              or uv.realname like '${query}%'
              or uv.code like '${query}%')
        </if>
        </where>
    </sql>
    <select id="selectOrgAdminList" resultMap="persistence.party.OrgAdminViewMapper.BaseResultMap" parameterType="map">
        select oo.* from ow_org_admin_view oo left join sys_user_view uv on oo.user_id=uv.id
         <include refid="orgAdminSearchSql"/>
        order by oo.type asc, oo.party_sort_order desc, oo.branch_party_sort_order desc, oo.branch_sort_order desc
    </select>
    <select id="countOrgAdminList" parameterType="map" resultType="java.lang.Integer">
       select count(oo.id) from ow_org_admin_view oo left join sys_user_view uv on oo.user_id=uv.id
         <include refid="orgAdminSearchSql"/>
    </select>
</mapper>