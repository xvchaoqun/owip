<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="persistence.cadre.common.ICadreWorkMapper">
    <select id="getCadreIdsOfWorkTypes" parameterType="map" resultType="java.lang.Integer" >
        <if test="andWorkTypes">
            select distinct cadre_id from
            (select  cw.cadre_id, group_concat(cw.work_types) as work_types from cadre_work cw
              <if test="cadreStatus != null">
              left join cadre c on cw.cadre_id=c.id
              where c.status = #{cadreStatus}
              </if>
             group by cw.cadre_id)tmp
            where
            <foreach collection="workTypes" item="workType" index="index"
                     open="(" close=")" separator=" and ">
                find_in_set(#{workType}, work_types)
            </foreach>
        </if>
        <if test="!andWorkTypes">
            select distinct cw.cadre_id from cadre_work cw
              left join cadre c on cw.cadre_id=c.id
            <where>
            <if test="cadreStatus != null">
              c.status = #{cadreStatus} and
            </if>
            <foreach collection="workTypes" item="workType" index="index"
                     open="(" close=")" separator=" or ">
                find_in_set(#{workType}, cw.work_types)
            </foreach>
            </where>
        </if>
    </select>

    <select id="getCadreIdsOfWorkDetail" parameterType="map" resultType="java.lang.Integer" >
         select distinct cadre_id from cadre_work cw
         left join cadre c on cw.cadre_id=c.id
         <where>
            cw.status=0 and
            <if test="cadreStatus != null">
              c.status = #{cadreStatus} and
            </if>
            <foreach collection="detailList" item="detail" open="(" close=")" separator=" or ">
                cw.detail like '%${detail}%'
            </foreach>
        </where>
    </select>

    <select id="getCadreIdsOfMajor" parameterType="map" resultType="java.lang.Integer" >
         select distinct cadre_id from cadre_edu ce
         left join cadre c on ce.cadre_id=c.id
         <where>
            ce.status=0 and
            <if test="cadreStatus != null">
              c.status = #{cadreStatus} and
            </if>
            <foreach collection="majorList" item="major" open="(" close=")" separator=" or ">
                ce.major like '%${major}%'
            </foreach>
        </where>
    </select>
</mapper>